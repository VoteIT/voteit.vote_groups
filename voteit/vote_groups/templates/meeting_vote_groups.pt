<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"
      xmlns:tal="http://xml.zope.org/namespaces/tal"
      metal:use-macro="view.macro('arche:templates/base_view.pt', 'arche:templates/inline.pt')"
      xmlns:i18n="http://xml.zope.org/namespaces/i18n"
      i18n:domain="voteit.vote_groups">
<body>
  <div metal:fill-slot="main-content">
  <h2 i18n:translate="meeting_vote_groups_header">
      Vote groups
  </h2>

  <div class="btn-group hidden-print" role="group">
    <a class="btn btn-default"
       tal:condition="request.is_moderator"
       href="${request.resource_url(context, 'add_vote_group')}"
       i18n:translate="">
        <span class="glyphicon glyphicon-plus"></span>
        New vote group
    </a>
    <a class="btn btn-default"
       tal:condition="request.is_moderator"
       href="javascript:window.print()"
       i18n:translate="">
        <span class="glyphicon glyphicon-print"></span>
        Print
    </a>
    <a class="btn btn-default"
       tal:condition="has_qr and request.is_moderator"
       href="${request.resource_url(context, '_qr_voter_groups')}"
       i18n:translate="">
        <span class="glyphicon glyphicon-qrcode"></span>
        Apply vote rights
    </a>

    <tal:delegation_controls condition="not request.is_moderator">
      <a class="buttonize"
         tal:condition="show_all"
         href="${request.resource_url(context, 'vote_groups')}"
         i18n:translate="">
          Hide <tal:ts i18n:name="count">${all_count - len(my_delegations)}</tal:ts> other delegations
      </a>
      <a class="buttonize"
         tal:condition="not show_all"
         href="${request.resource_url(context, 'vote_groups', query = {'show_all': '1'})}"
         i18n:translate="">
          Show <tal:ts i18n:name="count">${all_count - len(my_delegations)}</tal:ts> other delegations
      </a>
    </tal:delegation_controls>
  </div>
  <br/><br/>
  <div class="list-group">
    <form method="post"
          action="${request.resource_path(context, '__vote_group_save_roles__', query = {'vote_group': vote_group.name})}"
          class="list-group-item"
          data-roles-container
          tal:repeat="vote_group sorted_groups">
      <tal:group tal:define="has_standins vote_groups.get_free_standins(vote_group)">

      <h2 tal:content="vote_group.title and vote_group.title or vote_group.name">Title</h2>

      <p tal:condition="vote_group.description" tal:content="vote_group.description"></p>

      <div class="btn-group hidden-print" role="group"
          tal:condition="request.is_moderator">
          <a class="btn btn-default"
             href="${request.resource_url(context, 'edit_vote_group', query = {'vote_group': vote_group.name})}"
             i18n:translate="">
              Edit
          </a>
          <button class="btn btn-default"
             data-edit-roles
             i18n:translate="">
              Change roles
          </button>
          <button class="btn btn-primary"
             href=""
             data-save-roles
             i18n:translate="">
              Save roles
          </button>
          <a class="btn btn-default"
             href="${request.resource_url(context, 'delete_vote_group', query = {'vote_group': vote_group.name})}"
             i18n:translate="">
              Delete
          </a>
      </div>

      <table class="table table-striped">
        <thead>
          <tr>
            <th i18n:translate="">Member</th>
            <th i18n:translate="">Role</th>
            <th i18n:translate="">Stand-in</th>
          </tr>
        </thead>
        <tbody>
          <tr tal:repeat="(userid, role) vote_group.items()">
            <td>
              <a tal:replace="structure request.creators_info([userid], portrait = False)">Userid</a>
            </td>
            <td data-select-roles>
                <select name="${userid}">
                    <option tal:repeat="(value, desc) role_choices" value="${value}" tal:attributes="selected role==value">${desc}</option>
                </select>
                <span>${[c for c in role_choices if c[0]==role][0][1]}</span>
            </td>
            <td>
              <tal:if condition="role == 'primary'">
              <a tal:condition="userid in vote_group.assignments"
                 tal:replace="structure request.creators_info([vote_group.assignments[userid]], portrait = False)">Userid</a>
              <tal:actions tal:condition="request.is_moderator or request.authenticated_userid == userid">
                <a tal:condition="userid not in vote_group.assignments and has_standins"
                   class="btn btn-default pull-right"
                   href="${request.resource_url(context, 'assign_vote', query = {'vote_group': vote_group.name, 'primary': userid})}"
                   i18n:translate="">Choose stand-in</a>
                <a tal:condition="userid not in vote_group.assignments and not has_standins"
                   class="btn btn-default disabled pull-right"
                   href="#" i18n:translate="">No stand-ins available</a>
                <a tal:condition="userid in vote_group.assignments"
                   class="btn btn-default pull-right"
                   href="${request.resource_url(context, 'release_standin', query = {'vote_group': vote_group.name, 'primary': userid})}"
                   i18n:translate="">Release stand-in</a>
              </tal:actions>
              </tal:if>
            </td>
          </tr>
        </tbody>
      </table>

    </tal:group>
    </form><!-- list-group-item -->
  </div>
  </div>
</body>
</html>
